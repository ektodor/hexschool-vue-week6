import{_ as L,r as b,o as p,c as f,e,n as i,F as M,g as N,h as C,t as c,a as r,w as U,b as v,i as k,v as A}from"./index-ZwKvgVP8.js";var w={VITE_APP_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"ektodorwang-api",BASE_URL:"/hexschool-vue-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:u,VITE_APP_API_NAME:m}=w,S={data(){return{cart:{},user:{name:"",email:"",tel:"",address:""},message:"",isCartLoading:!1,isDetailLoading:!1}},methods:{getCartProducts(){this.$http.get(`${u}/api/${m}/cart`).then(s=>{this.cart=JSON.parse(JSON.stringify(s.data.data)),this.isDetailLoading=!1,this.isCartLoading=!1}).catch(s=>{this.errorMessage(s,"取得購物車列表失敗")})},deleteProduct(s){this.isCartLoading=!0,this.$http.delete(`${u}/api/${m}/cart/${s}`).then(t=>{this.getCartProducts(),alert("購物車更新成功")}).catch(t=>{this.errorMessage(t,"刪除購物車項目失敗 (單一)")})},deleteAllProducts(){this.$http.delete(`${u}/api/${m}/carts`).then(s=>{this.getCartProducts(),alert("購物車更新成功")}).catch(s=>{this.errorMessage(s,"刪除購物車項目失敗 (全部)")})},updateCartQuantity(s,t,x){this.isCartLoading=!0,this.$http.put(`${u}/api/${m}/cart/${s}`,{data:{product_id:t,qty:x}}).then(g=>{this.getCartProducts(),alert("購物車更新成功")}).catch(g=>{this.errorMessage(g,"更改產品數量失敗")})},checkoutProducts(){this.$http.post(`${u}/api/${m}/order`,{data:{user:this.user,message:this.message}}).then(s=>{this.user={name:"",email:"",tel:"",address:""},this.message="",this.getCartProducts(),alert("商品已完成結帳")}).then(s=>{this.errorMessage(s,"結帳失敗")})},errorMessage(s,t){console.error(s.message),alert(t)},isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"}},mounted(){this.getCartProducts()}},D={class:"container"},q={class:"text-end"},B={class:"table align-middle"},I=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),T=["onClick"],R={key:0,class:"fas fa-spinner fa-pulse"},O=e("div",{class:"text-success"},"已套用優惠券",-1),F={class:"input-group input-group-sm"},J={class:"input-group mb-3"},Q=["onUpdate:modelValue","onBlur"],j={class:"input-group-text",id:"basic-addon2"},z={class:"text-end"},$={class:"text-danger text-decoration-line-through"},G=e("br",null,null,-1),H=e("small",{class:"text-success"},"折扣價：",-1),K=e("td",{colspan:"3",class:"text-end"},"總計",-1),W={class:"text-end"},X=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Y={class:"text-end text-success"},Z={class:"my-5 row justify-content-center"},ee={class:"mb-3"},te=e("label",{for:"email",class:"form-label"},"Email",-1),se={class:"mb-3"},le=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),ae={class:"mb-3"},oe=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),re={class:"mb-3"},ne=e("label",{for:"address",class:"form-label"},"收件人地址",-1),de={class:"mb-3"},ie=e("label",{for:"message",class:"form-label"},"留言",-1),ce={class:"text-end"};function ue(s,t,x,g,a,n){var P,V;const h=b("v-field"),_=b("error-message"),E=b("v-form");return p(),f("div",D,[e("div",q,[e("button",{onClick:t[0]||(t[0]=(...l)=>n.deleteAllProducts&&n.deleteAllProducts(...l)),class:i(["btn btn-outline-danger",{disabled:!((V=(P=a.cart)==null?void 0:P.carts)!=null&&V.length)}]),type:"button"}," 清空購物車 ",2)]),e("table",B,[I,e("tbody",null,[a.cart.carts?(p(!0),f(M,{key:0},N(a.cart.carts,l=>(p(),f("tr",{key:l.id},[e("td",null,[e("button",{onClick:d=>n.deleteProduct(l.id),type:"button",class:"btn btn-outline-danger btn-sm"},[a.isCartLoading?(p(),f("i",R)):C("",!0),v(" x ")],8,T)]),e("td",null,[v(c(l.product.title)+" ",1),O]),e("td",null,[e("div",F,[e("div",J,[k(e("input",{"onUpdate:modelValue":d=>l.qty=d,min:"1",type:"number",class:"form-control",onBlur:d=>n.updateCartQuantity(l.id,l.product.id,l.qty)},null,40,Q),[[A,l.qty,void 0,{number:!0}]]),e("span",j,c(l.product.unit),1)])])]),e("td",z,[e("small",$,"原價："+c(l.total),1),G,H,v(" "+c(l.final_total),1)])]))),128)):C("",!0)]),e("tfoot",null,[e("tr",null,[K,e("td",W,c(a.cart.total),1)]),e("tr",null,[X,e("td",Y,c(a.cart.final_total),1)])])]),e("div",Z,[r(E,{ref:"form",class:"col-md-6",onSubmit:n.checkoutProducts},{default:U(({errors:l})=>{var d,y;return[e("div",ee,[te,r(h,{id:"email",name:"email",type:"email",class:i(["form-control",{"is-invalid":l.email}]),rules:"email|required",placeholder:"請輸入 Email",modelValue:a.user.email,"onUpdate:modelValue":t[1]||(t[1]=o=>a.user.email=o)},null,8,["class","modelValue"]),r(_,{name:"email",class:"invalid-feedback"})]),e("div",se,[le,r(h,{id:"name",name:"姓名",type:"text",class:i(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:a.user.name,"onUpdate:modelValue":t[2]||(t[2]=o=>a.user.name=o)},null,8,["class","modelValue"]),r(_,{name:"姓名",class:"invalid-feedback"})]),e("div",ae,[oe,r(h,{id:"tel",name:"電話",type:"tel",class:i(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",rules:n.isPhone,modelValue:a.user.tel,"onUpdate:modelValue":t[3]||(t[3]=o=>a.user.tel=o)},null,8,["class","rules","modelValue"]),r(_,{name:"電話",class:"invalid-feedback"})]),e("div",re,[ne,r(h,{id:"address",name:"地址",type:"text",class:i(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:a.user.address,"onUpdate:modelValue":t[4]||(t[4]=o=>a.user.address=o)},null,8,["class","modelValue"]),r(_,{name:"地址",class:"invalid-feedback"})]),e("div",de,[ie,k(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[5]||(t[5]=o=>a.message=o)},null,512),[[A,a.message]])]),e("div",ce,[e("button",{class:i([{disabled:!((y=(d=a.cart)==null?void 0:d.carts)!=null&&y.length)},"btn btn-danger"]),type:"submit"},"送出訂單",2)])]}),_:1},8,["onSubmit"])])])}const he=L(S,[["render",ue]]);export{he as default};
