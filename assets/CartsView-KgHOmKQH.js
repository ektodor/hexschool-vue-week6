import{_ as y,r as _,o as i,c as d,e,F as C,g as P,h as g,t as c,a as r,w as V,b,i as f,v,n as m}from"./index-haLzW5IE.js";const k={data(){return{apiUrl:"https://ec-course-api.hexschool.io/v2",apiPath:"ektodorwang-api",cart:{},user:{name:"",email:"",tel:"",address:""},message:"",isCartLoading:!1,isDetailLoading:!1}},methods:{getCartProducts(){this.$http.get(`${this.apiUrl}/api/${this.apiPath}/cart`).then(s=>{this.cart=JSON.parse(JSON.stringify(s.data.data)),this.isDetailLoading=!1,this.isCartLoading=!1}).catch(s=>{this.errorMessage(s,"取得購物車列表失敗")})},deleteProduct(s){this.isCartLoading=!0,this.$http.delete(`${this.apiUrl}/api/${this.apiPath}/cart/${s}`).then(t=>{this.getCartProducts(),alert("購物車更新成功")}).catch(t=>{this.errorMessage(t,"刪除購物車項目失敗 (單一)")})},deleteAllProducts(){this.$http.delete(`${this.apiUrl}/api/${this.apiPath}/carts`).then(s=>{this.getCartProducts(),alert("購物車更新成功")}).catch(s=>{this.errorMessage(s,"刪除購物車項目失敗 (全部)")})},updateCartQuantity(s,t){this.isCartLoading=!0,this.$http.put(`${this.apiUrl}/api/${this.apiPath}/cart/${s}`,{data:{product_id:s,qty:t}}).then(p=>{this.getCartProducts(),alert("購物車更新成功")}).catch(p=>{this.errorMessage(p,"更改產品數量失敗")})},checkoutProducts(){this.$http.post(`${this.apiUrl}/api/${this.apiPath}/order`,{data:{user:this.user,message:this.message}}).then(s=>{this.user={name:"",email:"",tel:"",address:""},this.message="",this.getCartProducts(),alert("商品已完成結帳")}).then(s=>{this.errorMessage(s,"結帳失敗")})},errorMessage(s,t){console.error(s.message),alert(t)},isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"}},mounted(){this.getCartProducts()}},U={class:"container"},w={class:"text-end"},L={class:"table align-middle"},N=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),M=["onClick"],q={key:0,class:"fas fa-spinner fa-pulse"},B=e("div",{class:"text-success"},"已套用優惠券",-1),S={class:"input-group input-group-sm"},D={class:"input-group mb-3"},A=["onUpdate:modelValue","onBlur"],E={class:"input-group-text",id:"basic-addon2"},F={class:"text-end"},J={class:"text-danger text-decoration-line-through"},O=e("br",null,null,-1),Q=e("small",{class:"text-success"},"折扣價：",-1),T=e("td",{colspan:"3",class:"text-end"},"總計",-1),$={class:"text-end"},j=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),z={class:"text-end text-success"},G={class:"my-5 row justify-content-center"},H={class:"mb-3"},I=e("label",{for:"email",class:"form-label"},"Email",-1),K={class:"mb-3"},R=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),W={class:"mb-3"},X=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),Y={class:"mb-3"},Z=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ee={class:"mb-3"},te=e("label",{for:"message",class:"form-label"},"留言",-1),se={class:"text-end"},le={key:0,type:"submit",class:"btn btn-danger"},ae={key:1,type:"submit",class:"btn btn-danger disabled"};function oe(s,t,p,re,a,n){const u=_("v-field"),h=_("error-message"),x=_("v-form");return i(),d("div",U,[e("div",w,[e("button",{onClick:t[0]||(t[0]=(...l)=>n.deleteAllProducts&&n.deleteAllProducts(...l)),class:"btn btn-outline-danger",type:"button"}," 清空購物車 ")]),e("table",L,[N,e("tbody",null,[a.cart.carts?(i(!0),d(C,{key:0},P(a.cart.carts,l=>(i(),d("tr",{key:l.id},[e("td",null,[e("button",{onClick:o=>n.deleteProduct(l.id),type:"button",class:"btn btn-outline-danger btn-sm"},[a.isCartLoading?(i(),d("i",q)):g("",!0),b(" x ")],8,M)]),e("td",null,[b(c(l.product.title)+" ",1),B]),e("td",null,[e("div",S,[e("div",D,[f(e("input",{"onUpdate:modelValue":o=>l.qty=o,min:"1",type:"number",class:"form-control",onBlur:o=>n.updateCartQuantity(l.id,l.qty)},null,40,A),[[v,l.qty,void 0,{number:!0}]]),e("span",E,c(l.product.unit),1)])])]),e("td",F,[e("small",J,"原價："+c(l.total),1),O,Q,b(" "+c(l.final_total),1)])]))),128)):g("",!0)]),e("tfoot",null,[e("tr",null,[T,e("td",$,c(a.cart.total),1)]),e("tr",null,[j,e("td",z,c(a.cart.final_total),1)])])]),e("div",G,[r(x,{ref:"form",class:"col-md-6",onSubmit:n.checkoutProducts},{default:V(({errors:l})=>[e("div",H,[I,r(u,{id:"email",name:"email",type:"email",class:m(["form-control",{"is-invalid":l.email}]),rules:"email|required",placeholder:"請輸入 Email",modelValue:a.user.email,"onUpdate:modelValue":t[1]||(t[1]=o=>a.user.email=o)},null,8,["class","modelValue"]),r(h,{name:"email",class:"invalid-feedback"})]),e("div",K,[R,r(u,{id:"name",name:"姓名",type:"text",class:m(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:a.user.name,"onUpdate:modelValue":t[2]||(t[2]=o=>a.user.name=o)},null,8,["class","modelValue"]),r(h,{name:"姓名",class:"invalid-feedback"})]),e("div",W,[X,r(u,{id:"tel",name:"電話",type:"tel",class:m(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",rules:n.isPhone,modelValue:a.user.tel,"onUpdate:modelValue":t[3]||(t[3]=o=>a.user.tel=o)},null,8,["class","rules","modelValue"]),r(h,{name:"電話",class:"invalid-feedback"})]),e("div",Y,[Z,r(u,{id:"address",name:"地址",type:"text",class:m(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:a.user.address,"onUpdate:modelValue":t[4]||(t[4]=o=>a.user.address=o)},null,8,["class","modelValue"]),r(h,{name:"地址",class:"invalid-feedback"})]),e("div",ee,[te,f(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[5]||(t[5]=o=>a.message=o)},null,512),[[v,a.message]])]),e("div",se,[a.cart.carts.length>0?(i(),d("button",le,"送出訂單")):(i(),d("button",ae,"送出訂單"))])]),_:1},8,["onSubmit"])])])}const ie=y(k,[["render",oe]]);export{ie as default};
